#cloud-config

hostname: gitlab

timezone: Europe/Paris

users:
  - name: devops
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: sudo
    ssh-authorized-keys:
      - ssh-rsa XXXXXXXXXXXXXXXX

package_update: true
package_upgrade: true
packages:
  - curl
  - openssh-server
  - ca-certificates
  - tzdata
  - perl

runcmd:
  - echo "postfix postfix/mailname string gitlab.local" | sudo debconf-set-selections
  - echo "postfix postfix/main_mailer_type string 'Internet Site'" | sudo debconf-set-selections
  - sudo DEBIAN_FRONTEND=noninteractive apt install -y postfix
  - curl
    https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh
    | sudo bash
  - sudo EXTERNAL_URL="192.168.0.18" apt install -y gitlab-ce